《深入浅出 NodeJS》：

#### 为什么要做 Node？

p2 第一段：Ryan Dahl 是一名资深的 C/C++ 程序员，在创作出 Node 之前，它的主要工作都是围绕着高性能 Web 服务器进行的。经历过一些尝试和失败之后，他找到了设计高性能，Web 服务器的几个要点：**事件驱动、非阻塞 IO。**

p2 第三段：JavaScript 的门槛比 C 的开发门槛要低，比 Lua 的历史包袱少。尽管服务器端 JavaScript 存在已经很多年了，但是后端部分一直没有市场，可以说历史包袱为零，为其导入非阻塞 I/O 库没有额外阻力。另外，JavaScript 在浏览器中有广泛的事件驱动方面的应用，暗合 Ryan Dahl 喜好基于事件驱动的需求。当时，第二次浏览器大战也渐渐分出高下，Chrome 浏览器的 JavaScript 引擎 V8 摘得性能第一桂冠，而且其基于新 BSD 许可证发布，自然收到 Ryan Dahl 欢迎。**考虑到高性能、符合事件驱动、没有历史包袱这三个主要原因，JavaScript 成为了 Node 的实现语言。**

#### 为什么叫 Node？

p2：一开始 Dyan Dahl 叫它的项目为 web.js，就是一个 Web 服务器，但是项目的发展超过了他最初单纯开发一个 Web 服务器的想法，变成了构建网络应用的一个基础框架，这样可以在它的基础上构建更多的东西，诸如服务器、客户端、命令行工具等。Node 发展为一个不共享任何资源的单线程、单进程系统，包含十分适宜的库，为构建大型分布式应用程序提供基础设施，其目标也是成为一个构建快速、可伸缩的网络应用平台。它自身非常简单，通过通信协议来组织许多 Node，非常容易通过扩展来达成构建大型网络应用的目的。每一个 Node 进程都构成这个网络应用中的一个节点，这是它名字所含意义的真谛。

#### Node 给 JavaScript 带来的意义？

p3 第一段最后一句：JavaScript 作为一门图灵完备的语言，长久以来却限制在浏览器的沙箱中运行，它的能力取决于浏览器的中间层提供的支持有多少。

p3 第二段：除了 HTML、WebKit 和显卡这些 UI 相关的技术没有支持外，Node 的结构与 Chrome 十分相似。他们都是基于事件驱动的异步架构，浏览器通过事件驱动来服务界面上的交互，Node 通过事件驱动来服务 I/O。在 Node 中，JavaScript可以随心所欲地访问本地文件，可以搭建 WebSocket 服务器端，可以连接数据库，可以加如 Web Workers 一样玩转多进程。如今 JavaScript 可以运行在不同的地方，不再继续限制在浏览器中与 CSS 样式表、DOM 树打交道。如果 HTTP 协议是水平面，Node 就是浏览器在协议栈另一边的倒影。Node 不处理 UI，但用与浏览器相同的机制和原理运行。Node 打破了过去 JavaScript 只能在浏览器中运行的局面。前后端编程环境统一，可以大大降低前后端转换所需要的上下文交换代价。

#### Node 的特点?

- 异步 IO
- 事件与回调函数
- 单线程
- 跨平台

#### Node 的应用场景？

- I/O 密集型
- 是否不擅长 CPU 密集型业务：（p9 第二段第三句）CPU 密集型应用给 Node 带来的主要挑战是：由于 JavaScript 单线程的原因，如果有长时间运行的计算（如大循环），将会导致 CPU 时间片不能释放，使得后续 I/O 无法发起。但是适当调整和分解大型运算任务为多个小任务，使得运算能够适时释放，不阻塞 I/O 调用的发起，这样既可以同时享受到并行异步 I/O 的好处，又能充分利用 CPU。
  - （p9 第三段）关于 CPU 密集型应用，Node 的异步 I/O 已经解决了在单线程上 CPU 与 I/O 之间阻塞无法重叠利用的问题，I/O 阻塞造成的性能浪费远比 CPU 的影响小。对于长时间运行的计算，如果它的耗时超过普通阻塞 I/O 的耗时，那么应用场景就需要重新评估，因为这类计算比 I/O 还要影响效率，甚至说就是一个纯计算场景，根本没有 I/O。此类应用场景或许应当采用多线程的方式进行计算。**Node 虽然没有提供多线程用于计算支持，但是还是有以下两个方式来充分利用 CPU。**
    - Node 可以通过编写 C/C++ 扩展的方式更高效地利用 CPU，将一些 V8 不能做到性能极致的地方通过 C/C++ 来实现。这种方式比 Java 还快。
    - 如果单线程的 Node 不能满足需求，甚至用了 C/C++ 扩展后还觉得不够，那么通过子进程的方式，将一部分 Node 进程当作常驻服务进程进行计算，然后利用进程间的消息来传递结果，将计算和 I/O 分离，这样还可以充分利用多核 CPU。
- 与历史遗留和平共处
- 分布式应用：
  - 阿里巴巴数据平台对 Node 的分布式应用算是一个典型的例子。分布式应用意味着对可伸缩性的要求非常高。数据平台通常要在一个数据库集群中去寻找需要的数据。阿里巴巴开发了中间层应用 NodeFox、ITier，将数据库集群做了划分和映射，查询调用依旧是针对单张表进行 SQL 查询，中间层分解查询 SQL，并行地去多台数据库中获取数据并且合并。NodeFox 能实现对多台 MySQL 数据库查询，如同查询一台 MySQL 一样，而 ITier 更强大，查询多个数据库如同查询一个数据库一样，这里的数据库指的是多个数据库。如 MySQL 或其他的数据库。
  - 这个案例其实也是高效利用并行 I/O 的例子。Node 高效利用 I/O 的过程，也是高效使用数据库的过程。对于 Node ，这个行为也只是一个普通的 I/O。对于数据库而言，却是一次复杂的计算，所以也是进而充分压榨硬件资源的过程。

#### 其他后端语言会被 Node 干掉吗？

在 Web 端，过去大多都是同步方式编写的程序，这种串行调用下层应用数据的过程中充斥着串行的等待时间，如果采用多线程来解决这种串行等待，又或多或少地显得小题大作。在 Node 中，语言层面即可天然并行的特性在这种场景中显得十分有效。**对于已有的稳定系统，并非意味着我们要抛弃掉。**（难道说新系统就应该用 Node 做？）

LinkedIn 在他们的移动版网站上的实践非常典型地说明了这个问题。旧有的系统具有非常稳定的数据输出，持续为传统网站服务，同时为移动版提供数据源，**Node 将该数据源作为数据接口，发挥异步并行的优势，而不用关心它背后是用什么语言实现的。**

雪球财经是从旧有的 Java 项目中分离出一个子项目，在这个子项目中，没有继续采用 Java/JSP 而是采用 Node 来完成 Web 端的开发，使得前端工程师在 HTTP 协议栈的两端能够高效灵活地开发，避免了 Java 繁琐的表达；另一方面，又利用 Java 作为后端接口和中间件，使其具有良好的稳定性。两者相互结合，取长补短。

#### Node 使用者

- 前后端编程语言的统一
- Node 带来的高性能 I/O 用于实时应用
- 并行 I/O 使得使用者可以更高效的利用分布式的环境
- 并行 I/O 有效利用稳定接口提升 Web 渲染能力
- 云计算平台提供 Node 支持
- 游戏开发领域
- 工具类应用：过去依赖 Java 或其他语言构建的前端工具类应用，纷纷被一些前端工程师用 Node 重写，用前端熟悉的语言为前端构建熟悉的工具

《狼书》：
大多数人认为，Node.js 只能用于编写网站后台或者前端工具，这其实是不全面的，Node.js 的目标是让并发编程更简单，主要应用在以网络编程为主的 I/O 密集型应用中。